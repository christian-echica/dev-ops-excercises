# Install Docker on your target EC2 

# Install dependencies
sudo yum install -y docker git


# Add current user to docker group
sudo usermod -aG docker $USER

# Start Docker service
sudo service docker start



# Install Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" \
-o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose


# Install Node as root 
curl –sL https://rpm.nodesource.com/setup_10.x | sudo bash -
sudo yum install –y nodejs
sudo yum install gcc g++ make
node –version

# How to start a node proj?
- On you working directory execute a command # npm init -y (this will create a package.json)
- create an index.js file 

index.js 
--------
const http = require('http');

const hostname = '0.0.0.0';
const port = 3000;

const server = http.createServer((req, res) => {
  res.statusCode = 200;
  res.setHeader('Content-Type', 'text/plain');
  res.end('Hello, World!\n');
});

server.listen(port, hostname, () => {
  console.log(`Server running at http://${hostname}:${port}/`);
});

- Create a Dockerfil 
FROM node:latest

WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .

EXPOSE 3000
CMD [ "npm", "start" ]

- Modify the package.json with start command 
{
  "name": "ec2-nodejs-dockerfile",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC"
}

# Build the Dockerfile 
docker build -t my-node-app .

# Run the docker nodejs container 
docker run -p 3000:3000 my-node-app
